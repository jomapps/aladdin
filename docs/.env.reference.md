# Environment Variables Reference

This document explains all environment variables used in the Aladdin Dynamic Agents system.

## ‚úÖ Already Configured

These are already set up and working:

### Database & Core
- `DATABASE_URI` - MongoDB connection string ‚úì
- `PAYLOAD_SECRET` - PayloadCMS secret key ‚úì

### AI & LLM
- `OPENROUTER_API_KEY` - OpenRouter API key for Claude access ‚úì
- `OPENROUTER_BASE_URL` - OpenRouter API endpoint ‚úì
- `OPENROUTER_DEFAULT_MODEL` - Default model (Claude Sonnet 4.5) ‚úì
- `OPENROUTER_BACKUP_MODEL` - Backup model ‚úì
- `CODEBUFF_API_KEY` - Codebuff SDK API key for agent execution ‚úì

### Media Generation
- `FAL_KEY` - Fal.ai API key for image generation ‚úì
- `ELEVENLABS_API_KEY` - ElevenLabs API key for voice ‚úì

### Storage
- `R2_*` - Cloudflare R2 storage credentials ‚úì

### Services
- `BRAIN_SERVICE_BASE_URL` - Brain service endpoint ‚úì
- `BRAIN_SERVICE_API_KEY` - Brain service API key ‚úì

---

## üîß Newly Added - Dynamic Agents System

These were just added for the dynamic agents system:

### Redis Configuration
```env
REDIS_URL=redis://localhost:6379/0        # Full Redis connection URL
```

**Format**: `redis://[username:password@]host[:port][/database]`

**Examples**:
- Local: `redis://localhost:6379/0`
- With password: `redis://:mypassword@localhost:6379/0`
- Remote: `redis://redis.example.com:6379/0`
- With auth: `redis://username:password@redis.example.com:6379/0`

**Action Required**:
- For local development: ‚úÖ Already configured correctly
- For production: Update to your Redis instance URL with credentials

---

### WebSocket Configuration
```env
WS_PORT=3001                              # WebSocket server port
WS_HOST=localhost                         # WebSocket host
WS_HEARTBEAT_INTERVAL=30000               # Ping interval (30 seconds)
WS_MAX_RECONNECT_ATTEMPTS=5               # Max reconnection attempts
```

**Action Required**:
- Default values work for local development
- For production, update `WS_HOST` to your domain
- Consider increasing `WS_HEARTBEAT_INTERVAL` for production (60000)

---

### Agent Execution Configuration
```env
AGENT_MAX_RETRIES=3                       # Max retries on failure
AGENT_RETRY_DELAY=1000                    # Delay between retries (ms)
AGENT_TIMEOUT=300000                      # Agent execution timeout (5 minutes)
AGENT_MAX_CONCURRENT_EXECUTIONS=10        # Max parallel agent executions
```

**Action Required**:
- Default values are conservative and work well
- For production, consider:
  - Increasing `AGENT_TIMEOUT` to 600000 (10 minutes) for complex tasks
  - Adjusting `AGENT_MAX_CONCURRENT_EXECUTIONS` based on server capacity

---

### Quality Scoring
```env
QUALITY_CACHE_TTL=3600                    # Cache TTL (1 hour)
QUALITY_MIN_THRESHOLD=60                  # Minimum acceptable quality score
QUALITY_ENABLE_CACHE=true                 # Enable quality assessment caching
```

**Action Required**:
- Default values work well
- If quality assessments change frequently, reduce `QUALITY_CACHE_TTL` to 1800 (30 min)
- Adjust `QUALITY_MIN_THRESHOLD` based on your quality standards (60-80 recommended)

---

### Audit Trail
```env
AUDIT_EXPORT_MAX_RATE=10                  # Max exports per rate window
AUDIT_EXPORT_RATE_WINDOW=60000            # Rate limiting window (1 minute)
AUDIT_CACHE_TTL=300                       # Audit query cache TTL (5 minutes)
AUDIT_MAX_PAGE_SIZE=100                   # Max items per page
```

**Action Required**:
- Default values provide good rate limiting
- For production with many users, consider:
  - Reducing `AUDIT_EXPORT_MAX_RATE` to 5
  - Increasing `AUDIT_CACHE_TTL` to 600 (10 minutes)

---

### Event Streaming
```env
EVENT_BUFFER_SIZE=100                     # Events buffered before flush
EVENT_FLUSH_INTERVAL=5000                 # Flush interval (5 seconds)
EVENT_RETENTION_DAYS=30                   # Days to keep events in DB
```

**Action Required**:
- Default values work well for most cases
- For high-volume production:
  - Increase `EVENT_BUFFER_SIZE` to 500
  - Reduce `EVENT_FLUSH_INTERVAL` to 2000 (2 seconds) for real-time feel
  - Adjust `EVENT_RETENTION_DAYS` based on compliance requirements

---

### Performance & Monitoring
```env
ENABLE_PERFORMANCE_MONITORING=true        # Enable performance tracking
LOG_LEVEL=info                            # Log level (debug, info, warn, error)
NODE_ENV=development                      # Environment (development, production)
```

**Action Required**:
- For production:
  - Set `NODE_ENV=production`
  - Set `LOG_LEVEL=warn` or `LOG_LEVEL=error`
  - Keep `ENABLE_PERFORMANCE_MONITORING=true` for analytics

---

## üìù Summary of Actions Required

### Minimal (Local Development)
‚úÖ No changes needed - defaults work for local development

### Recommended (Before Production)
1. Update `NODE_ENV=production`
2. Update `LOG_LEVEL=warn`
3. Update `WS_HOST` to your production domain
4. Set Redis password if using remote Redis
5. Increase `AGENT_TIMEOUT` to 600000 (10 minutes)
6. Adjust `AGENT_MAX_CONCURRENT_EXECUTIONS` based on server capacity

### Optional (Fine-tuning)
- Adjust quality thresholds based on requirements
- Tune rate limiting for audit exports
- Modify event buffer settings for performance
- Configure event retention days for compliance

---

## üîí Security Notes

**Already Secured** (Do NOT commit these to version control):
- All API keys are already in `.env` (which is gitignored) ‚úì
- No secrets in code ‚úì

**Additional Security Recommendations**:
1. Use environment-specific `.env` files (`.env.local`, `.env.production`)
2. Rotate API keys regularly
3. Use Redis password authentication in production
4. Enable SSL/TLS for Redis in production
5. Use secure WebSocket (WSS) in production

---

## üöÄ Quick Start

### For Local Development
```bash
# 1. Ensure Redis is running
redis-server

# 2. Start the application
npm run dev

# 3. WebSocket will be available at ws://localhost:3001
```

### For Production
```bash
# 1. Update environment variables as noted above
# 2. Set NODE_ENV=production
# 3. Use PM2 or similar for process management
# 4. Configure reverse proxy (nginx) for WebSocket
# 5. Use managed Redis service (AWS ElastiCache, Redis Cloud, etc.)
```

---

## üß™ Testing Configuration

For running tests, create `.env.test`:

```env
DATABASE_URI=mongodb://127.0.0.1/aladdin-test
REDIS_URL=redis://localhost:6379
CODEBUFF_API_KEY=test-key
OPENROUTER_API_KEY=test-key
NODE_ENV=test
LOG_LEVEL=error
```

---

## üìû Need Help?

- Check implementation docs: `/docs/IMPLEMENTATION-SUMMARY.md`
- Architecture details: `/docs/architecture/dynamic-agents-architecture.md`
- Component-specific docs in `/docs/agents/` and `/docs/components/`
